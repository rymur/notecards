{% extends 'notecards/base.html' %}

{% block body_block %}

	<a href="/notecards/get_card/{{ deck.id }}/">Drill Cards</a>
	<br />

	{{ deckform.as_p }}

	<h3>Cards</h3>
	<select size="10" name="cards" id="cards">
		{% for card in cards %}
			<option value={{ card.pk }}>{{ card.front }} -- {{ card.back }}</option>
		{% endfor %}
	</select>
	<br />
	{% if user == deck.author %}
		<button type="button" class="btn btn-danger" id="delbtn">Delete</button>
		<button type="button" class="btn btn-primary" id="editbtn">Edit</button>

		<h3>Add Cards</h3>
		<form id="cardcreate" action="#" method="POST">
			{% csrf_token %}
			{{ cardform.front.label_tag }}
			{{ cardform.front }}
			{{ cardform.back.label_tag }}
			{{ cardform.back }}
			<input type="submit" value="Create" />
		</form>
	{% elif user.is_authenticated %}
		<a href="{% url 'clone_deck' %}?did={{ deck.id }}">
			<button class="btn btn-success">
				Clone Deck
			</button>
		</a>
	{% endif %}
{% endblock %}

{% block script_block %}
	<script type="text/javascript">

		$("#cardcreate").submit(function(event) {
			event.preventDefault();

			var url = '/notecards/create_card/{{ deck.id }}/';
			var formData = $('#cardcreate').serialize();

			$.ajax({
				method: 'POST',
				url: url,
				data: formData,
				success: function(data) {
					$('#cards').append(data);
					$('#id_front').val('');
					$('#id_back').val('');
					$('#id_front').focus();
				}
			});
		});

		$("#delbtn").click(function() {
			var delCard = $("#cards option:selected").val();
			$.ajax({
				method: 'DELETE',
				url: '/notecards/edit_card/' + delCard + '/',
				success: function(data) {
					$("#cards option[value='" + delCard +"']").remove();
				}
			});
		});
	</script>
{% endblock %}